---

- hosts: localhost
  tasks:

  - name: Adding Docker repository key
    apt_key: keyserver="hkp://pgp.mit.edu:80" id="58118E89F3A912897C070ADBF76221572C52609D"
    become: yes

  - name: Adding Docker repository
    apt_repository: repo="deb https://apt.dockerproject.org/repo ubuntu-wily main" update_cache=yes
    become: yes

  - name: Adding Oracle Java repository
    apt_repository: repo="ppa:webupd8team/java" update_cache=yes
    become: yes

  - name: Accepting Oracle License (java)
    shell: echo debconf shared/accepted-oracle-license-v1-1 select true | sudo debconf-set-selections

  - name: Installing programming dependencies
    apt: pkg="{{item}}" state=latest
    become: yes
    with_items:
      - gfortran
      - libffi-dev
      - libblas-dev
      - libpng12-dev
      - liblapack-dev
      - libfreetype6-dev
      - libatlas-base-dev
      - libssl-dev
      - libxml2-dev
      - libxslt1-dev
      - python3-dev
      - python3-setuptools

  - name: Installing ubuntu packages
    apt: pkg="{{item}}" state=latest
    become: yes
    with_items:
      - latexmk
      - dvipng # latex generation of anki
      - qemu-kvm
      - graphviz
      - docker-engine
      - build-essential
      - exuberant-ctags
      - android-tools-adb
      - android-tools-fastboot
      - oracle-java8-installer
      - texlive-latex-extra
      - texlive-math-extra
      - texlive-science
      - texlive

  - name: Installing Clojure
    get_url: dest=~/bin/lein mode=0700 url=https://raw.githubusercontent.com/technomancy/leiningen/stable/bin/lein

  - name: Ensures ~/.lein directory exists
    file: path="~/.lein" state=directory

  - name: Deploying Leiningen configuration
    file: src="{{ansible_env.PWD}}/{{item.src}}" dest="{{item.dest}}" state=link force=yes
    with_items:
    - {src: "lein/profiles.clj", dest: "~/.lein/profiles.clj"}

  - name: Installing Python libraries
    pip: name="{{item}}" executable="pip3" extra_args="--user" state=latest
    with_items:
      # project
      - ipdb
      - wheel
      - virtualenv
      - cookiecutter
      # syntax
      - hy
      - yapf
      - autoflake
      - vocabulary
      # data analysis
      - arrow
      - pandas
      - ipython
      - jupyter
      - seaborn
      - sklearn
      - cairocffi
      - jellyfish
      - statsmodels
      - ipyparallel
      # database
      - redis
      - pymongo
      - mongoengine
      # web
      - flask
      - scrapy
      - httpie
      - jinja2
      - requests
      - selenium
      - jsbeautifier
      - beautifulsoup4

  - name: Checking if ipython profile exists
    stat: path="~/.ipython/profile_freaxmind/"
    register: ipython_profile

  - name: Creating ipython profile
    command: "~/.local/bin/ipython3 profile create freaxmind"
    when: ipython_profile.stat.exists == False

  - name: Deploying ipython configuration
    file: src="{{ansible_env.PWD}}/{{item.src}}" dest="{{item.dest}}" state=link force=yes
    with_items:
      - {src: "ipython/profile_freaxmind/ipython_config.py", dest: "~/.ipython/profile_freaxmind/ipython_config.py"}
