---

- hosts: localhost
  connection: local
  become: true

  tasks:

  - shell: test -f /usr/local/bin/stack
    register: root_stack_install
    ignore_errors: True

  - shell: test -f ~/.local/bin/stack
    register: local_stack_install
    ignore_errors: True

  - name: Installing stack (root install)
    shell: curl -sSL https://get.haskellstack.org/ | sh
    when: (root_stack_install|failed) and (local_stack_install|failed)

  - name: Installing stack dependencies (ubuntu)
    apt: pkg="{{item}}" state=latest
    when: ansible_distribution == 'Ubuntu'
    with_items:
      - libncurses-dev
  
  - name: Installing stack dependencies (fedora)
    dnf: pkg="{{item}}" state=latest
    when: ansible_distribution == 'Fedora'
    with_items:
      - zlib-devel
      - ncurses-devel

