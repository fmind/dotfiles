### SETTINGS ###

# Installation path
export ZSH=~/.oh-my-zsh

# Set name of the theme
# required for spaceship theme
export RPS1="%{$reset_color%}"
export SPACESHIP_EXIT_CODE_SHOW=true

ZSH_THEME="amuse"

# Set the custom folder
ZSH_CUSTOM=$HOME/.zsh.d

# Set the execution time
HIST_STAMPS="yyyy-mm-dd"

# Set the ZSH plugins list
plugins=(
    alias-tips
    celery
    command-not-found
    dnf
    docker
    encode64
    fasd
    gitfast
    git-extras
    httpie
    jsontools
    pyenv
    python
    systemd
    urltools
    vi-mode
    web-search
    zsh-autosuggestions
    zsh-syntax-highlighting
)

# Switch to vi
bindkey -v
export KEYTIMEOUT=1
bindkey '^o' clear-screen

# Make ZSH awesome
source $ZSH/oh-my-zsh.sh

### ALIASES ###

alias -g A='| ag'
alias -g B='| column -t'
alias -g C='| xsel --clipboard'
alias -g G='| grep'
alias -g H='| head'
alias -g HH='| head -n5'
alias -g I='| percol'
alias -g JP='| python3 -m json.tools'
alias -g JS='| jq -r'
alias -g L='| less'
alias -g M='--help'
alias -g N='| notify-send'
alias -g S='| sort'
alias -g T='| tail'
alias -g TT='| tail -n5'
alias -g U='| uniq'
alias -g V='| $EDITOR -'
alias -g W='| wc -l'
alias -g X='| xmllint --format -'
alias -g Y='| pyp'
alias -g Z='| pigz'
alias -g ZU='| unpigz -c'

### INCLUSIONS ###

if [ -f ~/.shellrc ]; then
    . ~/.shellrc
fi

if [ -f ~/.shell_environ ]; then
    . ~/.shell_environ
fi

if [ -f ~/.shell_aliases ]; then
    . ~/.shell_aliases
fi

if [ -f ~/.shell_private ]; then
    . ~/.shell_private
fi

# Enable autoenv (does not work in .shellrc)
if [ -x "$(command -v activate.sh)" ]; then
    source "$(which activate.sh)"
fi

# Enable percol history search
function exists { which $1 &> /dev/null }

if exists percol; then
    function percol_select_history() {
        local tac
        exists gtac && tac="gtac" || { exists tac && tac="tac" || { tac="tail -r" } }
        BUFFER=$(fc -l -n 1 | eval $tac | percol --query "$LBUFFER")
        CURSOR=$#BUFFER         # move cursor
        zle -R -c               # refresh
    }

    zle -N percol_select_history
    bindkey '^R' percol_select_history
fi
