---

- hosts: localhost
  tasks:

  - name: Installing packages (cli)
    apt: pkg="{{item}}" state=latest
    become: yes
    with_items:
      - zsh
      - byobu
      - vim
      - git
      - cmake
      - pandoc
      - python3
      - python-dev
      - python3-dev
      - python3-setuptools
      - silversearcher-ag
      - exuberant-ctags
      - build-essential
      - imagemagick
      - libssl-dev

  - name: Deploying shell configuration
    file: src="{{ansible_env.PWD}}/{{item.src}}" dest="{{item.dest}}" state=link force=yes
    with_items:
      - {src: "zsh/oh-my-zsh", dest: "~/.oh-my-zsh"}
      - {src: "zsh/inputrc", dest: "~/.inputrc"}
      - {src: "zsh/zshrc", dest: "~/.zshrc"}

  - name: Deploying editor configuration
    file: src="{{ansible_env.PWD}}/{{item.src}}" dest="{{item.dest}}" state=link force=yes
    with_items:
      - {src: "vim/vim", dest: "~/.vim"}
      - {src: "vim/vimrc", dest: "~/.vimrc"}
    notify:
      - install vim plugins
      - install vim auto-completion
        
  - name: Deploying version control system configuration
    file: src="{{ansible_env.PWD}}/{{item.src}}" dest="{{item.dest}}" state=link force=yes
    with_items:
      - {src: "git/gitconfig", dest: "~/.gitconfig"}
      - {src: "git/gitignore", dest: "~/.gitignore"}

  - name: Deploying project template configuration
    file: src="{{ansible_env.PWD}}/{{item.src}}" dest="{{item.dest}}" state=link force=yes
    with_items:
      - {src: "cookiecutters/cookiecutters", dest: "~/.cookiecutters"}
      - {src: "cookiecutters/cookiecutterrc", dest: "~/.cookiecutterrc"}

  - name: Changing user shell
    command: chsh -s /usr/bin/zsh "{{ansible_env.USER}}"
    become: yes
    when: ansible_user_shell != "/usr/bin/zsh"

  - name: Checking if ipython profile exists
    stat: path="~/.ipython/profile_freaxmind/"
    register: ipython_profile

  - name: Creating ipython profile
    command: "ipython profile create freaxmind"
    when: ipython_profile.stat.exists == False

  - name: Deploying ipython profile
    file: src="{{ansible_env.PWD}}/{{item.src}}" dest="{{item.dest}}" state=link force=yes
    with_items:
      - {src: "ipython/profile_freaxmind/ipython_config.py", dest: "~/.ipython/profile_freaxmind/ipython_config.py"}

  - name: Checking if shell font exists
    stat: path="~/.fonts/Droid Sans Mono Slashed for Powerline.ttf"
    register: shell_font

  - name: Installing additional fonts
    command: "{{ansible_env.PWD}}/vim/vim/bundle/fonts/install.sh"
    when: shell_font.stat.exists == False

  handlers:
    - name: install vim plugins
      command: "vim +PluginInstall +qall"

    - name: install vim auto-completion
      command: "python ~/.vim/bundle/YouCompleteMe/install.py --clang-completer"
