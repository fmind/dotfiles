---

- hosts: localhost
  tasks:

  - name: Deploying ansible configuration
    file: src="{{ansible_env.PWD}}/{{item.src}}" dest="{{item.dest}}" state=link force=yes
    with_items:
      - {src: "ansible.cfg", dest: "~/.ansible.cfg"}

  - name: Installing ubuntu packages
    apt: pkg="{{item}}" state=latest
    become: yes
    with_items:
      - zsh
      - vim
      - git
      - tree
      - htop
      - byobu
      - xclip
      - ipcalc
      - hexedit
      - parallel
      - emacs-nox
      - imagemagick
      - fonts-hack-ttf
      - silversearcher-ag

  - name: Cloning oh-my-zsh repository (zsh plugins)
    git: repo=https://github.com/robbyrussell/oh-my-zsh.git dest=~/.oh-my-zsh depth=1

  - name: Cloning Spacemacs repository (emacs plugins)
    git: repo=https://github.com/syl20bnr/spacemacs dest="~/.emacs.d" depth=1

  - name: Deploying zsh configuration
    file: src="{{ansible_env.PWD}}/{{item.src}}" dest="{{item.dest}}" state=link force=yes
    with_items:
      - {src: "zsh/face.icon", dest: "~/.face.icon"}
      - {src: "zsh/zshrc", dest: "~/.zshrc"}
      - {src: "zsh/zsh.d", dest: "~/.zsh.d"}

  - name: Deploying git configuration
    file: src="{{ansible_env.PWD}}/{{item.src}}" dest="{{item.dest}}" state=link force=yes
    with_items:
      - {src: "git/gitconfig", dest: "~/.gitconfig"}
      - {src: "git/gitignore", dest: "~/.gitignore"}

  - name: Deploying vim configuration
    file: src="{{ansible_env.PWD}}/{{item.src}}" dest="{{item.dest}}" state=link force=yes
    with_items:
      - {src: "vim/vimrc", dest: "~/.vimrc"}

  - name: Deploying emacs configuration
    file: src="{{ansible_env.PWD}}/{{item.src}}" dest="{{item.dest}}" state=link force=yes
    with_items:
      - {src: "emacs/spacemacs.d", dest: "~/.spacemacs.d"}
      - {src: "emacs/spacemacs", dest: "~/.spacemacs"}


  - name: Changing user shell
    command: chsh -s /usr/bin/zsh "{{ansible_env.USER}}"
    become: yes
    when: ansible_user_shell != "/usr/bin/zsh"
