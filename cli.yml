---

- hosts: localhost
  tasks:

  - name: Installing packages (cli)
    dnf: pkg="{{item}}" state=latest
    become: yes
    with_items:
      - zsh
      - vim
      - git
      - tree
      - byobu
      - pandoc
      - hexedit
      - emacs-nox
      - GraphicsMagick
      - the_silver_searcher
      - adobe-source-code-pro-fonts
      - python3-setuptools
      - python3-devel
      - python3

  - name: Creating a CUSTOM folder in $HOME
    file: path="~/.CUSTOM" state=directory

  - name: Deploying ansible configuration
    file: src="{{ansible_env.PWD}}/{{item.src}}" dest="{{item.dest}}" state=link force=yes
    with_items:
      - {src: "ansible.cfg", dest: "~/.ansible.cfg"}

  - name: Checking if oh-my-zsh exists
    stat: path="~/.oh-my-zsh"
    register: oh_my_zsh

  - name: Installing oh-my-zsh
    shell: sh -c "$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)"
    when: oh_my_zsh.stat.exists == False

  - name: Deploying shell configuration
    file: src="{{ansible_env.PWD}}/{{item.src}}" dest="{{item.dest}}" state=link force=yes
    with_items:
      - {src: "zsh/zsh-custom", dest: "~/.CUSTOM/zsh"}
      - {src: "zsh/face.icon", dest: "~/.face.icon"}
      - {src: "zsh/inputrc", dest: "~/.inputrc"}
      - {src: "zsh/zshrc", dest: "~/.zshrc"}

  - name: Deploying Byobu configuration
    file: src="{{ansible_env.PWD}}/{{item.src}}" dest="{{item.dest}}" state=link force=yes
    with_items:
      - {src: "zsh/tmux.conf", dest: "~/.byobu/.tmux.conf"}

  - name: Cloning Vundle repository (vim plugins)
    git: repo=https://github.com/VundleVim/Vundle.vim.git dest=~/.vim/bundle/Vundle.vim

  - name: Deploying vim configuration
    file: src="{{ansible_env.PWD}}/{{item.src}}" dest="{{item.dest}}" state=link force=yes
    with_items:
      - {src: "vim/vimrc", dest: "~/.vimrc"}
    notify:
      - install vim plugins

  - name: Cloning Spacemacs repository
    git: repo=https://github.com/syl20bnr/spacemacs dest="~/.emacs.d"

  - name: Deploying emacs configuration
    file: src="{{ansible_env.PWD}}/{{item.src}}" dest="{{item.dest}}" state=link force=yes
    with_items:
      - {src: "emacs/spacemacs", dest: "~/.spacemacs"}
      - {src: "emacs/spacemacs-custom", dest: "~/.CUSTOM/spacemacs"}
        
  - name: Deploying version control system configuration
    file: src="{{ansible_env.PWD}}/{{item.src}}" dest="{{item.dest}}" state=link force=yes
    with_items:
      - {src: "git/gitconfig", dest: "~/.gitconfig"}
      - {src: "git/gitignore", dest: "~/.gitignore"}

  - name: Deploying project template configuration
    file: src="{{ansible_env.PWD}}/{{item.src}}" dest="{{item.dest}}" state=link force=yes
    with_items:
      - {src: "cookiecutters/cookiecutterrc", dest: "~/.cookiecutterrc"}

  - name: Changing user shell
    command: chsh -s /usr/bin/zsh "{{ansible_env.USER}}"
    become: yes
    when: ansible_user_shell != "/usr/bin/zsh"

  - name: Installing Python libraries (pip3)
    pip: name="{{item}}" executable="pip3" extra_args="--user" state=latest
    with_items:
      # sysadmin
      - glances

  - name: Checking if shell font exists
    stat: path="~/.fonts/Droid Sans Mono Slashed for Powerline.ttf"
    register: shell_font

  - name: Installing additional fonts
    command: /bin/true
    when: shell_font.stat.exists == False
    notify:
        - install vim fonts

  handlers:
    - name: install vim plugins
      command: "vim +PluginInstall +qall"

    - name: install vim fonts
      command: "~/.vim/bundle/fonts/install.sh"
