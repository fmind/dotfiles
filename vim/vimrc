" SECURITY
"{{{
set nomodeline
set nocompatible
"}}}
" CHECKUP
"{{{
let VIMDIR=$HOME.'/.vim/'

if exists('*mkdir')
    for subdir in ['backup', 'session', 'plugged', 'snippets', 'spell', 'swap', 'undo']
        if !isdirectory(VIMDIR.subdir)
            call mkdir(VIMDIR.subdir)
        endif
    endfor
endif
"}}}
" SETTINGS
"{{{
""" DISPLAY
set mouse=a
set splitright
set splitbelow
set scrolloff=15
set sidescrolloff=5

""" THEMING
set title
set showcmd
set showmode
set t_Co=256
set background=dark
set colorcolumn=100
let g:loaded_matchparen=1

""" SIDEBAR
set ruler
set number
set relativenumber

""" STATUSBAR
set wildmenu
set shortmess=c
set laststatus=2
set wildmode=full
set wildignore+=*.pdf,*.bbl,*.aux,*.pyc

""" FOLDING
set foldlevel=20
set foldmethod=marker
set foldlevelstart=10

""" WRAPPING
set wrap
set linebreak
set textwidth=0

""" EDITION
set hidden
set autoread
set autowrite
set encoding=utf-8
set ffs=unix,dos,mac
set clipboard=unnamedplus
set suffixes=.swp,.jpg,.png,.jpeg,.gif,.pyc,.pyo

""" NAVIGATION
set gdefault
set incsearch
set smartcase
set ignorecase
set nohlsearch

""" IDENTATION
set expandtab
set autoindent
set shiftround
set tabstop=4 
set shiftwidth=4
set softtabstop=4
set backspace=indent,eol,start

""" NOTIFICATION
set noerrorbells
set novisualbell

""" PERFORMANCE
set ttyfast
set lazyredraw

""" BACKUP
set backup
set undofile
set updatecount=100
set undodir=$HOME/.vim/undo/
set directory=$HOME/.vim/swap/
set backupdir=$HOME/.vim/backup/
set viminfo ='200,n$HOME/.vim/viminfo
"}}}
" HOOKS
"{{{
""" automatic spelling and wrapping on open, read and save
autocmd BufNewFile,BufRead *.{txt,tex,rst,md} setlocal spell spelllang=en textwidth=100 whichwrap+=h,l,<,>,[,]

""" restore last position of the cursor when opening a file
autocmd BufReadPost *
    \ if line("'\"") > 1 && line("'\"") <= line("$") |
    \   exe "normal! g`\"" |
    \ endif

""" specific to Python
autocmd BufNewFile,BufRead *.py setlocal foldmethod=indent
"}}}
" PLUGINS
"{{{
syntax enable
filetype plugin on
filetype indent on

if !empty(glob($HOME.'/.vim/autoload/plug.vim'))
call plug#begin($HOME.'/.vim/plugged')
""" DISPLAY
Plug 'tomasr/molokai'
Plug 'bling/vim-airline' 
let g:airline_powerline_fonts=1
let g:airline#extensions#tabline#enabled = 1
Plug 'airblade/vim-gitgutter'
""" EDITION
Plug 'tpope/vim-repeat'
Plug 'tpope/vim-surround'
Plug 'tpope/vim-commentary'
Plug 'Raimondi/delimitMate'
Plug 'junegunn/vim-easy-align'
Plug 'easymotion/vim-easymotion'
Plug 'christoomey/vim-sort-motion'
Plug 'michaeljsmith/vim-indent-object'
""" IDE FEATURES
Plug 'janko-m/vim-test'
let g:test#preserve_screen = 1
let test#python#runner = 'pytest'
Plug 'SirVer/ultisnips'
let g:UltiSnipsEditSplit = 'context'
let g:UltiSnipsSnippetsDir = $HOME.'/.vim/snippets/'
Plug 'junegunn/fzf.vim'
Plug 'junegunn/fzf', {'dir': '~/.fzf', 'do': './install --bin'}
Plug 'mhinz/vim-startify'
Plug 'scrooloose/nerdtree' 
let NERDTreeIgnore=['\.pyc$', '\~$']
Plug 'Chiel92/vim-autoformat'
let g:formatters_python = ['yapf']
Plug 'sheerun/vim-polyglot'
Plug 'scrooloose/syntastic'
set statusline+=%*
set statusline+=%#warningmsg#
set statusline+=%{SyntasticStatuslineFlag()}
let g:syntastic_check_on_wq = 0
let g:syntastic_check_on_open = 0
let g:syntastic_auto_loc_list = 1
let g:syntastic_always_populate_loc_list = 1
let g:syntastic_python_checkers=['flake8']
Plug 'jistr/vim-nerdtree-tabs'
Plug 'Valloric/YouCompleteMe', {'dir': $HOME.'/.vim/plugged/YouCompleteMe/', 'do': './install.py'}
let g:ycm_goto_buffer_command = 'new-or-existing-tab'
let g:ycm_autoclose_preview_window_after_completion= 1
let g:ycm_key_list_select_completion = ['<C-n>', '<Down>']
let g:ycm_key_list_previous_completion = ['<C-p>', '<Up>']
"""" PYTHON LANGUAGE
Plug 'fisadev/vim-isort'
"""" OTHER LANGUAGES
"Plug 'vim-pandoc/vim-pandoc'
"nnoremap <leader>P :Pandoc<CR>
" Plug 'godlygeek/tabular'
" nnoremap <leader>T :Tabularize 
"Plug 'plasticboy/vim-markdown'
"let g:vim_markdown_no_default_key_mappings = 1
"Plug 'vim-pandoc/vim-pandoc-syntax'
Plug 'beloglazov/vim-online-thesaurus'
call plug#end()
try
colorscheme molokai
catch
endtry
endif
"}}}
" KEYBINDINGS
 "{{{
""" LEADER KEYS
map ; :
vmap ; :
noremap ;; ;
let mapleader="\<Space>"
let maplocalleader=","
 
""" BREAK HABITS
nnoremap Q :q!<CR>
nnoremap <Up> <NOP>
nnoremap <Down> <NOP>
nnoremap <Left> <NOP>
nnoremap <Right> <NOP>

""" BETTER DEFAULT
nnoremap j gj
nnoremap k gk
vnoremap j gj
vnoremap k gk
xnoremap <  <gv
xnoremap >  >gv
inoremap jk  <Esc>
inoremap kj  <Esc>
cnoremap <c-p> <up>
cnoremap <c-n> <down>
nnoremap <expr> n  'Nn'[v:searchforward]
nnoremap <expr> N  'nN'[v:searchforward]
 
""" BASIC ACTIONS
nnoremap <leader>z za
nnoremap <leader>Z zM
nnoremap <leader>? :help 
nnoremap <leader>e :tabedit 
vnoremap <leader>s :sort<CR>
nnoremap <leader>m :make<CR>

""" ADVANCED ACTIONS
"""""" execute shell command
nnoremap <leader>! :!
nnoremap <leader>R :r!
"""""" format current buffer
nnoremap <leader>+ gggqG
"""""" format inside paragrah
nnoremap <leader>= gqip
" highlight last inserted text
nnoremap <leader>v `[v`]
" Switch between the last two files
nnoremap <leader>j <c-^>
"""""" write a file as sudo
nnoremap <leader>W :w !sudo tee > /dev/null %<CR>
"""""" add spelling for en/fr
nnoremap <leader>C :setlocal spell! spelllang=en,fr<CR>
"""""" edit the current macro
nnoremap <leader>@  :<c-u><c-r><c-r>='let @'. v:register .' = '. string(getreg(v:register))<cr><c-f><left>

""" TAB MANAGEMENT
nnoremap <leader><Tab> gt
nnoremap <leader><S-Tab> gT

""" WINDOWS MANAGEMENT
nnoremap <C-h> <C-w>h
nnoremap <C-j> <C-w>j
nnoremap <C-k> <C-w>k
nnoremap <C-l> <C-w>l
nnoremap <leader>H :split<CR>
nnoremap <leader>V :vsplit<CR>

""" PLUGINS MANAGEMENT
nnoremap <leader>PR :source $MYVIMRC<CR>
nnoremap <leader>PI :PlugInstall<CR>
nnoremap <leader>PG :PlugUpgrade<CR>
nnoremap <leader>PU :PlugUpdate<CR>
nnoremap <leader>PS :PlugStatus<CR>
nnoremap <leader>PC :PlugClean<CR>
nnoremap <leader>PL :PlugList<CR>
nnoremap <leader>PD :PlugDocs<CR>
nnoremap <leader>PD :PlugDocs<CR>

""" PLUGINS CONFIGURATIONS
xmap ga <Plug>(EasyAlign)
nmap ga <Plug>(EasyAlign)
nnoremap <leader>/ :Ag<CR>
nnoremap <leader>T :Tags<CR>
nnoremap <leader>t :BTags<CR>
nnoremap <leader>' :Marks<CR>
nnoremap <leader>L :Lines<CR>
nnoremap <leader>l :BLines<CR>
nnoremap <leader>F :GFiles<CR>
nnoremap <leader>f :Files .<CR>
nnoremap <leader>b :Buffers<CR>
nnoremap <leader>h :History<CR>
nnoremap <leader>w :Windows<CR>
nnoremap <leader>i :Snippets<CR>
nnoremap <leader>c :Commands<CR>
nnoremap <leader>SL :SLoad<CR>
nnoremap <leader>SS :SSave<CR>
nnoremap <leader>SC :SClose<CR>
nnoremap <leader>SD :SDelete<CR>
nnoremap <leader>q :Autoformat<CR>
nnoremap <leader>I :UltiSnipsEdit<CR>
nnoremap <leader>g :YcmCompleter GoTo<CR>
nnoremap <leader>` :NERDTreeTabsToggle<CR>
nnoremap <leader>d :YcmCompleter GetDoc<CR>
nnoremap <leader>- :SyntasticToggleMode<CR>

nnoremap <localleader>i :Isort<CR>
nnoremap <localleader>f :TestFile<CR>
nnoremap <localleader>l :TestLast<CR>
nnoremap <localleader>s :TestSuite<CR>
nnoremap <localleader>g :TestVisit<CR>
nnoremap <localleader>t :TestNearest<CR>

""" INTERNAL CONFIGURATIONS
nnoremap <leader>MB :buffers<CR>
nnoremap <leader>ML :message<CR>
nnoremap <leader>MP :register<CR>
nnoremap <leader>MR :source $MYVIMRC<CR>
nnoremap <leader>MM :tabedit $MYVIMRC<CR>
"}}}
